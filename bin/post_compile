#!/usr/bin/env bash
set -euo pipefail

echo "Compiling Python sources (syntax check)..."
python -m compileall -q trustcheck_agent

if command -v cargo &> /dev/null && [ -d "spidercrawl" ]; then
    echo "Building Rust spider crawler module..."
    cd spidercrawl
    cargo build --release
    if [ -f "target/release/libspidercrawl.so" ]; then
        cp target/release/libspidercrawl.so ../trustcheck_agent/spidercrawl.so
        echo "Rust spider module installed"
    fi
    cd ..
else
    echo "Cargo not found or spidercrawl not present, using Python fallback"
fi

echo "Installing Playwright Chromium..."
python -m playwright install chromium
